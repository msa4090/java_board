package home;

import java.text.SimpleDateFormat;
import java.util.*;

public class HomepageManager {
	ArrayList<HomepageClass> list = new ArrayList<>();	
	DetailPage dp = new DetailPage();
	Scanner sc = new Scanner(System.in);
	private int count = 1;	// ê²Œì‹œë¬¼ ë²ˆí˜¸(index)ëŠ” 1ë¶€í„° ì‹œì‘
	
	void add() {		
		HomepageClass h = new HomepageClass();
		String check = "";
		
		System.out.println("ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”. : ");
		h.setTitle(sc.nextLine());
		check = h.getTitle().replace(" ", "");
		if(check.equals("")) {
			System.out.println("ì œëª©ì€ ê³µë°±ì´ ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤! ê²Œì‹œë¬¼ ì¶”ê°€ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.");
			add();
		}
		
		System.out.println("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”. : ");
		h.setContents(sc.nextLine());
		
		System.out.println("ì‘ì„±ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”. ");
		h.setWriter(sc.nextLine());
		check = h.getWriter().replace(" ", "");
		if(check.equals("")) {
			System.out.println("ì‘ì„±ì ì´ë¦„ì€ ê³µë°±ì´ ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤! ê²Œì‹œë¬¼ ì¶”ê°€ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤");
			add();
		}
		
		System.out.println("ê²Œì‹œë¬¼ ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ê²Œì‹œë¬¼ì„ ì‚­ì œí•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.) : ");
		h.setPw(sc.nextLine());
		if(h.getPw().length() != 4) {
			System.out.println("ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬ê°€ ì•„ë‹™ë‹ˆë‹¤! ê²Œì‹œë¬¼ ì¶”ê°€ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.");
			add();
		}
		
		SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
		Date time = new Date();
		String date = format.format(time);
		h.setDate_time(date);
		
		h.setIndex(count);
		count++;
		
		h.setContent_like(0);
		h.setContent_unlike(0);
		
		list.add(h);
	}
	
	void delete() {
		System.out.println("ì‚­ì œí•˜ê³  ì‹¶ì€ ê²Œì‹œë¬¼ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
		int n = sc.nextInt();

		if(list.get(n - 1) == null) {
			System.out.println("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²Œì‹œë¬¼ ë²ˆí˜¸ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”.");
		}
		
		sc.nextLine();
		
		System.out.println("í•´ë‹¹ ê²Œì‹œë¬¼ì˜ ì‘ì„±ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");
		String name = sc.nextLine();
		
		System.out.println("í•´ë‹¹ ê²Œì‹œë¬¼ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
		String pw = sc.nextLine();
		
		if(!list.get(n - 1).getWriter().equals(name)) {
			System.out.println("ì‘ì„±ì ì´ë¦„ì´ ë‹¤ë¦…ë‹ˆë‹¤!");
		} else if(!list.get(n - 1).getPw().equals(pw)) {
			System.out.println("ë¹„ë°€ë²ˆí˜¸ê°€ ë‹¤ë¦…ë‹ˆë‹¤!");
		} else {
			System.out.println("í•´ë‹¹ ê²Œì‹œë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
			list.remove(n - 1);			
		}
	}
	
	void printPage() {
		ArrayList<Integer[]> printList = new ArrayList<>();
				
		String str = "";
		
		System.out.println("ì •ë ¬ì„ ì›í•˜ëŠ” ê¸°ì¤€ì„ ì…ë ¥í•˜ì„¸ìš”. [comment, like, unlike, not sort]");
		str = sc.nextLine();
		
		System.out.println("----------------------------------------------------------------------");
		// ëŒ“ê¸€ ë§ì€ ìˆœì„œ
		if(str.equals("comment")) {
			// 2ì°¨ì› ì–´ë ˆì´ë¦¬ìŠ¤íŠ¸ printList ëŠ” ê²Œì‹œíŒ ë²ˆí˜¸ì™€ listì˜ ëŒ“ê¸€ ê°¯ìˆ˜ë¥¼ ê°€ì§€ê³  ìˆë‹¤. 
			for(int i = 0; i < list.size(); i++) {
				printList.add(new Integer[] {i, list.get(i).getCommentList().size()});
			}
			Collections.sort(printList, new Comparator<Integer[]>() {
				@Override
				public int compare(final Integer[] a1, final Integer[] a2) {
					return Integer.compare(a1[0], a2[0]); 
				}
			});
			for(int i = 0; i < list.size(); i++) {
				if(list.get(printList.get(i).length).getCommentList().size() == 0) {
					System.out.println(list.get(printList.get(i)[0]).getIndex() + ". " + list.get(printList.get(i)[0]).getTitle() + "       ì‘ì„±ì : " + list.get(printList.get(i)[0]).getWriter() + "  ğŸ‘ : " + list.get(printList.get(i)[0]).getContent_like() + " ğŸ‘ : " + list.get(printList.get(i)[0]).getContent_unlike() + " ì‘ì„± ì¼ì‹œ : " + list.get(printList.get(i)[0]).getDate_time());
				} else {
					System.out.println(list.get(printList.get(i)[0]).getIndex() + ". " + list.get(printList.get(i)[0]).getTitle() + " [" + list.get(printList.get(i)[0]).getCommentList().size() + "]   ì‘ì„±ì : " + list.get(printList.get(i)[0]).getWriter() + "  ğŸ‘ : " + list.get(printList.get(i)[0]).getContent_like() + " ğŸ‘ : " + list.get(printList.get(i)[0]).getContent_unlike() + " ì‘ì„± ì¼ì‹œ : " + list.get(printList.get(i)[0]).getDate_time());
				}
			}
		}
		// ì¢‹ì•„ìš” ë§ì€ ìˆœì„œ
		if(str.equals("like")) {

			for(int i = 0; i < list.size(); i++) {
				printList.add(new Integer[] {list.get(i).getContent_like(), i});
			}
		}
		// ì‹«ì–´ìš” ë§ì€ ìˆœì„œ
		if(str.equals("unlike")) {

			for(int i = 0; i < list.size(); i++) {
				printList.add(new Integer[] {list.get(i).getContent_unlike(), i});
			}
		}
		
		// ì •ë ¬ x
		if(str.equals("not sort")) {			
			for(int i = 0; i < list.size(); i++) {
				if(list.get(i).getCommentList().size() == 0) {
					System.out.println(list.get(i).getIndex() + ". " + list.get(i).getTitle() + "       ì‘ì„±ì : " + list.get(i).getWriter() + "  ğŸ‘ : " + list.get(i).getContent_like() + " ğŸ‘ : " + list.get(i).getContent_unlike() + " ì‘ì„± ì¼ì‹œ : " + list.get(i).getDate_time());
				} else {
					System.out.println(list.get(i).getIndex() + ". " + list.get(i).getTitle() + " [" + list.get(i).getCommentList().size() + "]   ì‘ì„±ì : " + list.get(i).getWriter() + "  ğŸ‘ : " + list.get(i).getContent_like() + " ğŸ‘ : " + list.get(i).getContent_unlike() + " ì‘ì„± ì¼ì‹œ : " + list.get(i).getDate_time());
				}
			}			
		}
		System.out.println("----------------------------------------------------------------------");
	}
	
	void readPage() {
		if(list.isEmpty()) {
			System.out.println("ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.");
		} else {
			System.out.println("ê²€ìƒ‰í•˜ì‹¤ ê²Œì‹œë¬¼ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
			int n = sc.nextInt();
			sc.nextLine(); // ì…ë ¥ ì°½ì— ë‚¨ì•„ìˆëŠ” ì°Œêº¼ê¸° ê°’ ì œê±°
			
			try {
				// í•´ë‹¹ ê²Œì‹œë¬¼ ì¶œë ¥
				System.out.println(list.get(n - 1).getIndex() + ". " + list.get(n - 1).getTitle() + "   ì‘ì„±ì : " + list.get(n - 1).getWriter() + " ì‘ì„± ì¼ì‹œ : " + list.get(n - 1).getDate_time());
				System.out.println("   " + list.get(n - 1).getContents());
				// ëŒ“ê¸€ ì¶œë ¥
				printCommentList(n - 1);
				
				String str = "";				
				
				while(true) {
					System.out.println("ìˆ˜í–‰í•˜ì‹¤ ëª…ë ¹ì„ ì…ë ¥í•˜ì„¸ìš”. [comment, revise comment, like, exit] ");
					str = sc.nextLine();
					// ëŒ“ê¸€ ë‹¬ê¸°
					if(str.equals("comment")) {
						list.get(n - 1).setCommnets_index(1 + list.get(n - 1).getCommnets_index());
						// 0 : ëŒ“ê¸€ ë²ˆí˜¸, 1 : ëŒ“ê¸€ ë‚´ìš©, 2 : ëŒ“ê¸€ ì´ë¦„, 3 : ëŒ“ê¸€ ì‘ì„±ì‹œê°„
						list.get(n - 1).commentList.add(new String[] {Integer.toString(list.get(n - 1).getCommnets_index()), dp.addComments(), dp.addComments_name(), dp.addComments_date()});
//						break;
					}
					if(str.equals("revise comment")) {
						
						int index = 0;
						System.out.println("ìˆ˜ì •í•  ëŒ“ê¸€ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” : ");
						index = sc.nextInt();
						sc.nextLine();
						
						String name = "";
						System.out.println("ëŒ“ê¸€ ì‘ì„±ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” : ");
						name = sc.nextLine();	
						
						if(list.get(n - 1).getCommentList().get(index - 1)[0] == null) {
							System.out.println("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ëŒ“ê¸€ì…ë‹ˆë‹¤!");
						} else if(!list.get(n - 1).getCommentList().get(index - 1)[2].equals(name)) {
							System.out.println("ëŒ“ê¸€ ì‘ì„±ì ì´ë¦„ì´ ë‹¤ë¦…ë‹ˆë‹¤!");
						} else {
							System.out.println("í˜„ì¬ ëŒ“ê¸€ ë‚´ìš© : " + list.get(n - 1).getCommentList().get(index - 1)[2]);
							System.out.println("ìˆ˜ì •í•  ëŒ“ê¸€ ë‚´ìš© : ");							
							
							list.get(n - 1).getCommentList().get(index - 1)[1] = sc.nextLine();

							System.out.println("ëŒ“ê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
						}
					}
					// ì¢‹ì•„ìš” ëˆ„ë¥´ê¸°
					// íšŒì›ê¸°ëŠ¥ êµ¬í˜„ë˜ë©´ ì¤‘ë³µë°©ì§€ ì¶”ê°€
					if(str.equals("like")) {
						list.get(n - 1).setContent_like(1 + list.get(n - 1).getContent_like());
						System.out.println("í•´ë‹¹ ê²Œì‹œë¬¼ì— ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ìŠµë‹ˆë‹¤.");
					}
					// ì‹«ì–´ìš” ëˆ„ë¥´ê¸°
					if(str.equals("unlike")) {
						
					}
					// ì´ˆê¸°í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
					if(str.equals("exit")) {
						System.out.println("ì´ˆê¸°í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.");
						break;
					}
				}
			// ì˜ˆì™¸ ë°œìƒ ì‹œ ì•„ë˜ì˜ ë¬¸êµ¬ë¥¼ ì¶œë ¥í•˜ê³  ì´ˆê¸°í™”ë©´ìœ¼ë¡œ ë˜ëŒì•„ê°. 
			} catch(Exception e) {
				System.out.println("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²Œì‹œë¬¼ì…ë‹ˆë‹¤.");
			}			
		}		
	}
	
	void printCommentList(int n) {		
		System.out.println("----------------------------------------------------------------------");
		for(int i = 0; i < list.get(n).getCommentList().size(); i++) {
			System.out.println(" " + list.get(n).getCommentList().get(i)[0] + ") " + list.get(n).getCommentList().get(i)[1] + " ì‘ì„±ì : " + list.get(n).getCommentList().get(i)[2] + " ì‘ì„± ì¼ì‹œ : " + list.get(n).getCommentList().get(i)[3]);		
		}
	}
	
	void updatePage() {
		if(list.isEmpty()) {
			System.out.println("ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.");
		} else {
			System.out.println("ìˆ˜ì •í•˜ì‹¤ ê²Œì‹œë¬¼ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
			int n = sc.nextInt();
			sc.nextLine(); // ì…ë ¥ ì°½ì— ë‚¨ì•„ìˆëŠ” ì°Œêº¼ê¸° ê°’ ì œê±°
			try {
				String str = "";
				
				while(true) {
					System.out.println("ìˆ˜í–‰í•˜ì‹¤ ëª…ë ¹ì„ ì…ë ¥í•˜ì„¸ìš”. [title revise, content revise, exit]");
					str = sc.nextLine();
					
					if(str.equals("title revise")) {
						System.out.println("í˜„ì¬ ì œëª© : " + list.get(n - 1).getTitle());
						System.out.println("ë³€ê²½í•  ì œëª© : ");
						list.get(n - 1).setTitle(sc.nextLine());
						System.out.println("ì œëª©ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
						break;
					}
					
					if(str.equals("content revise")) {
						System.out.println("í˜„ì¬ ë‚´ìš© : " + list.get(n - 1).getContents());
						System.out.println("ë³€ê²½í•  ë‚´ìš© : ");
						list.get(n - 1).setContents(sc.nextLine());
						System.out.println("ë‚´ìš©ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
						break;
					}
					
					if(str.equals("exit")) {
						System.out.println("ì´ˆê¸°í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.");
						break;
					}
				}
				
			} catch (Exception e) {
				System.out.println("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²Œì‹œë¬¼ì…ë‹ˆë‹¤.");
			}
		}
	}
	
	public ArrayList<HomepageClass> getList() {
		return list;
	}
	
	public void setList(ArrayList<HomepageClass> list) {
		this.list = list;
	}
}
